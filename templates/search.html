<!DOCTYPE html>
<html>
<head>
    <title>Search</title>
    <style>
        body {
            text-align: center; /* 居中对齐 */
            font-family: Arial, sans-serif; /* 字体样式 */
            color: white; /* 设置文字颜色为白色 */
            background-color: #333; /* 设置背景颜色为暗色 */
        }
        #searchForm {
            margin-top: 20px;
        }
        /* 设置搜索结果的样式 */
        #results {
            display: inline-block; /* 使容器成为内联块 */
            text-align: left; /* 左对齐容器内的元素 */
            margin-top: 20px;
            margin-left: auto; /* 与右边距一起实现居中 */
            margin-right: auto;
        }

        #results p {
            margin: 5px 0; /* 设置段落间距 */
        }
        .tab {
            cursor: pointer; /* 鼠标悬停时的手势 */
            padding: 10px;
            border: 1px solid #ccc;
            display: inline-block; /* 使标签并排显示 */
        }
        .tab.active {
            background-color: #f0f0f0; /* 活动标签的背景颜色 */
        }
        /* 添加用于定位链接的 CSS */
        .top-right {
            position: absolute;
            right: 10px;
            top: 10px;
        }
        .tab {
            cursor: pointer;
            padding: 10px;
            border: 1px solid #ccc;
            display: inline-block;
            color: white; /* 设置标签文字颜色为白色 */
            background-color: #555; /* 设置非活动标签的背景颜色为深色 */
        }
        .tab.active {
            background-color: #999; /* 设置活动标签的背景颜色为浅色 */
            color: black; /* 设置活动标签的文字颜色为黑色 */
        }
        /* 为链接添加白色样式，确保它们在暗色背景上可见 */
        a {
            color: white;
        }
        a:hover {
            color: #ddd;
        }
    </style>
</head>
<body>
    <!-- 使用 top-right 类来定位链接 -->
    <div class="top-right">
        <a href="/admin">Admin Panel</a>
    </div>

    <div id="tabs">
        <!-- 动态生成标签，初始时选中 'All Labels' -->
        <span class="tab active" onclick="selectTab('')">All</span>
    </div>

    <form id="searchForm">
        <input type="text" id="keyword" placeholder="Enter keyword">
        <input type="hidden" id="label" value=""> <!-- 隐藏的标签输入，由 JavaScript 控制 -->
        <button type="submit">Search</button>
    </form>

    <div id="results"></div>

    <script>
        // 当文档加载完成时，获取并显示所有标签
        document.addEventListener('DOMContentLoaded', function() {
            fetch('/labels')
                .then(response => response.json())
                .then(data => {
                    var tabsDiv = document.getElementById('tabs');
                    data.forEach(label => {
                        var span = document.createElement('span');
                        span.className = 'tab';
                        span.textContent = label;
                        span.onclick = function() { selectTab(label); };
                        tabsDiv.appendChild(span);
                    });
                    // 默认激活 'All Labels' 标签
                    selectTab('');
                })
                .catch(error => console.error('Error:', error));
        });



        function selectTab(label) {
            document.getElementById('label').value = label;
            // 更新选中标签的样式
            var tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
                if (tab.textContent === label || (label === '' && tab.textContent === 'All')) {
                    tab.classList.add('active');
                }
            });
        }

        document.getElementById('searchForm').onsubmit = function(event) {
            event.preventDefault();
            var keyword = document.getElementById('keyword').value;
            var label = document.getElementById('label').value;
            fetch(`/search?keyword=${encodeURIComponent(keyword)}&label=${encodeURIComponent(label)}`)
                .then(response => response.json())
                .then(data => {
                    var resultsDiv = document.getElementById('results');
                    resultsDiv.innerHTML = '';
                    data.forEach(node => {
                        // 添加 target="_blank" 以在新标签页中打开链接
                        var nodeLink = `<a href="/show/${node.id}" target="_blank">${node.name}</a>`;
                        var nodeLabels = node.labels.join(', ');
                        resultsDiv.innerHTML += `<p><mark>${nodeLabels}</mark> ${nodeLink}</p>`;
                    });
                })
                .catch(error => console.error('Error:', error));
        };
    </script>
</body>
</html>
